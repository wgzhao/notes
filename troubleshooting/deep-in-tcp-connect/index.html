
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录日常工作、学习的一些文档，收藏看到好的资源等">
      
      
        <meta name="author" content="wgzhao">
      
      
        <link rel="canonical" href="https://wgzhao.github.io/notes/troubleshooting/deep-in-tcp-connect/">
      
      
        <link rel="prev" href="../capture-http-requests-with-tcpdump/">
      
      
        <link rel="next" href="../docker-run-no-space-left/">
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS 订阅" href="../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="已更新内容的 RSS 订阅" href="../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.1">
    
    
      
        <title>详解 TCP 半连接队列与全连接队列 - 个人笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tcp" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="个人笔记" class="md-header__button md-logo" aria-label="个人笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            个人笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              详解 TCP 半连接队列与全连接队列
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/wgzhao/notes" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    wgzhao/notes
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../tags/" class="md-tabs__link">
        
  
    
  
  Tags

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../bigdata/ambari-cli/" class="md-tabs__link">
          
  
    
  
  Bigdata

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../courses/commands-in-sbin/" class="md-tabs__link">
          
  
    
  
  Courses

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../database/maridb-ax-setup/" class="md-tabs__link">
          
  
    
  
  Database

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../kubernetes/access-k8s-pod-from-outersider/" class="md-tabs__link">
          
  
    
  
  Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../misc/Latex%20Math%20Symbols/" class="md-tabs__link">
          
  
    
  
  Misc

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../programming/design-restful-api-with-python-and-flask/" class="md-tabs__link">
          
  
    
  
  Programming

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tips/bash-tips/" class="md-tabs__link">
          
  
    
  
  Tips

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../capture-http-requests-with-tcpdump/" class="md-tabs__link">
          
  
    
  
  Troubleshooting

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="个人笔记" class="md-nav__button md-logo" aria-label="个人笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    个人笔记
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/wgzhao/notes" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    wgzhao/notes
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bigdata
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Bigdata
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/ambari-cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用 Ambari API 来操作 Hadoop 集群
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/flink-cdc-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flink SQL CDC 实践以及一致性分析
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/integrating-hive-with-spark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrating Apache Hive with Apache Spark
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/integrating-phoenix-with-kerberos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phoenix 集成 HBase 并支持 Kerberos 认证
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/ipa-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    free IPA setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/kerberos-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MIT Kerberos  安装及维护手册
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/mafengwo-warehouse-design-and-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    马蜂窝数据仓库设计与实践
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/presto-with-ssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presto SSL 配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bigdata/zookeeper-optimize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zookeeper集群应对万级并发的调优
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Courses
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Courses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/commands-in-sbin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux 命令学习
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/linux-cfs-scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux CFS 调度器：原理、设计与内核实现
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/pg9_high_performance_notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《PostgreSQL 9 High Performance》读书笔记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mysql lecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Mysql lecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/mysql-lecture/mysql-practices-lecture-45-1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《MySQL 实战45讲》节选第一部分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/mysql-lecture/mysql-practices-lecture-45-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《MySQL 实战45讲》节选第二部分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/mysql-lecture/mysql-practices-lecture-45-3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《MySQL 实战45讲》节选第三部分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/mysql-lecture/mysql-practices-lecture-45-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《MySQL 实战45讲》节选第四部分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/mysql-lecture/mysql-practices-lecture-45-5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    《MySQL 实战45讲》节选第五部分
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Time series analysis
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Time series analysis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/time-series-analysis/01-basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基础篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/time-series-analysis/02-primer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    初级篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/time-series-analysis/03-advance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    进阶篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/time-series-analysis/04-practices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    应用篇
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../courses/time-series-analysis/05-complete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    补完篇
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/maridb-ax-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MariaDB AX 安装测试简记
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/mysql-cluster-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MySQL Cluster 配置
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/oracle-11g-imp-and-exp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oracle 11g 导入导出基本操作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/oracle-silent-installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Oracle 静默安装
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/percona-cluster-with-haproxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HAProxy + Percona XtraDB Cluster 部署
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/setup-a-clickhouse-cluster-on-one-node/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    在一个节点上部署 ClickHouse 集群
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/why-mysql8-slower-than-mysql57/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    默认配置下，为什么 MySQL 8.0 比 MySQL 5.7 慢
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/access-k8s-pod-from-outersider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    外部机器如何直接直接访问 kubernetes 集群内服务
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/calico-node-troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Calico Node 无法启动的排查
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/collect-k8s-log-with-filebeat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    基于 ELK 的 日志收集与自动索引创建
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/coredns-support-hosts-file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CoreDNS 支持解析宿主机的 hosts 文件
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/deep-dive-into-k8s-internals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用奇怪的方式构建简单 k8s 集群
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/how-to-create-user-for-k8s-dashboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    在 Kubernetes Dashboard 创建基于 RBAC 的授权用户
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/kubernetes-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用 kubeadm 安装 kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/take-flannel-to-calico/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrate kubernetes cluster from Flannel to Calico
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/Latex%20Math%20Symbols/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用于 LateX 的数学符号
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/git-from-zero-to-hero/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git从入门到应付日常工作
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/gitlab-ci-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gitlab-ci.yml 详解
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/osint-introduce/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    超级情报手机工具库：开源验证和调查工具及使用方法
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Programming
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Programming
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/design-restful-api-with-python-and-flask/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用 Python 和 Flask 设计 RESTful API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/programming-with-vim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    无插件Vim编程技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/pure-bash-bible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pure Bash Bible
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../programming/understanding-awk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding AWK
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tips
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Tips
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/bash-tips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BASH 的一些技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/batch-convert-word-to-pdf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows 下批量转换 word 文档为 pdf 的方法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/change-keyboard-layout-in-ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ubuntu 下修改键盘映射
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/git-internals-objects-branches-create-repo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Git 内部原理图解 -- 对象、分支以及如何从零开始建仓库
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/git-tips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    git 不常见的操作技巧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/how-to-create-dummy-rpm-package/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速创建一个虚假 RPM 包
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/howto-change-git-author/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to change git author name and email
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/howto-delete-old-images-from-nexus-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    如何删除 nexus 私服上的 Docker 镜像
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/howto-save-tmux-session/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to save tmux session
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/learn-seaborn-with-10min/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    十分钟掌握 Seaborn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/matplotlib-support-chinese/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    让 Python 中 matplotlib 图支持中文
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/move-running-process-into-tmux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    把一个运行的进程放到 tmux 会话中
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/rpm-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rpm 包管理基本技能
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/sed-one-line-tips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SED 单行脚本快速参考
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/setup-gitlab-ci-for-android/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup Gitlab CI For Android
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/ssh-three-key-features/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssh的三板斧
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/ssh-tips/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH examples, tips and tunnels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tips/wechat-contacts-backup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    微信通讯录备份
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            Troubleshooting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capture-http-requests-with-tcpdump/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCPDump Capture HTTP GET/POST requests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    详解 TCP 半连接队列与全连接队列
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    详解 TCP 半连接队列与全连接队列
    
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      前言
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      半连接队列、全连接队列
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      相关指标查看
    </span>
  </a>
  
    <nav class="md-nav" aria-label="相关指标查看">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ss" class="md-nav__link">
    <span class="md-ellipsis">
      ss 命令
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-socket" class="md-nav__link">
    <span class="md-ellipsis">
      对于 LISTEN 状态的 socket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-socket_1" class="md-nav__link">
    <span class="md-ellipsis">
      对于非 LISTEN 状态的 socket
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      全连接队列实战
    </span>
  </a>
  
    <nav class="md-nav" aria-label="全连接队列实战">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      最大长度控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      实验
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      全连接队列溢出
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      半连接队列实战
    </span>
  </a>
  
    <nav class="md-nav" aria-label="半连接队列实战">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      半连接队列最大长度控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-syn" class="md-nav__link">
    <span class="md-ellipsis">
      判断是否 Drop SYN 请求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      实验一
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      实验二
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      实验三
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      实验四
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      实验五：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      回顾线上问题
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker-run-no-space-left/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker 运行容器报磁盘空间不足的错误
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fix-ora-00227/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    修复 Oracle ORA-00227 错误
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../jdk1.6-support-tlsv1.2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    让 Oracle JDK 1.6 TLSv1.2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <nav class="md-tags" >
    
      
      
      
        <a href="../../tags/#tag:tcp" class="md-tag">tcp</a>
      
    
  </nav>



<h1 id="tcp">详解 TCP 半连接队列与全连接队列<a class="headerlink" href="#tcp" title="Permanent link">&para;</a></h1>
<p><a href="https://www.51cto.com/article/687595.html">Source</a></p>
<p>这篇文档的原始来源为 <a href="https://www.51cto.com/article/687595.html">https://www.51cto.com/article/687595.html</a> ，我按照文档的思路，自己进行了实现并根据实际的实际情况进行了调整。</p>
<p>以下实验的配置环境为：</p>
<ul>
<li>服务端: </li>
<li>CPU:  11<sup>th</sup> Gen Intel(R) Core(TM) i5-1135G7 @ 2.40GHz</li>
<li>OS: Ubuntu 22.10 x86_64</li>
<li>IP: 192.168.31.76</li>
<li>客户端：</li>
<li>CPU:  3.4 GHz 四核Intel Core i5</li>
<li>OS: macOS Ventura 13.2.1</li>
<li>IP: 192.168.31.205</li>
</ul>
<h2 id="_1">前言<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>某次大促值班 ing，对系统稳定性有着充分信心、心态稳如老狗的笔者突然收到上游反馈有万分几的概率请求我们 endpoint 会出现 Connection timeout 。此时系统侧的 apiserver 集群水位在 40%，离极限水位还有着很大的距离，当时通过紧急扩容 apiserver 集群后错误率降为了 0。事后进行了详细的问题排查，定位分析到问题根因出现在系统连接队列被打满导致，之前笔者对 TCP 半连接队列、全连接队列不太了解，只依稀记得 《TCP/IP 详解》中好像有好像提到过这两个名词。</p>
<p>本篇文章将结合理论知识、内核代码、操作实验为你呈现如下内容：</p>
<ul>
<li>半连接队列、全连接队列介绍</li>
<li>常用命令介绍</li>
<li>全连接队列实战 —— 最大长度控制、全连接队列溢出实验、实验结果分析</li>
<li>半连接队列实战 —— 最大长度控制、半连接队列溢出实验、实验结果分析</li>
</ul>
<h2 id="_2">半连接队列、全连接队列<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>sequenceDiagram
    participant 客户端
    participant 服务器
    客户端-&gt;&gt;服务器: SYN(seq=x)
    服务器-&gt;&gt;客户端: SYN+ACK(seq=y, ack=x+1)
    客户端-&gt;&gt;服务器: ACK(ack=y+1)
    loop 数据传输
        客户端-&gt;&gt;服务器: DATA(seq=x+n, ack=y+m)
        服务器-&gt;&gt;客户端: DATA(seq=y+m, ack=x+n+1)
    end</code></pre>
<p><a href="https://s3.51cto.com/oss/202110/27/3d05f574867b70d1134e685e5f5ac137.jpg"><img alt="img" src="../../images/3d05f574867b70d1134e685e5f5ac137.jpg" /></a></p>
<p>在 TCP 三次握手的过程中，Linux 内核会维护两个队列，分别是：</p>
<ul>
<li>半连接队列 (SYN Queue)</li>
<li>全连接队列 (Accept Queue)</li>
</ul>
<p>正常的 TCP 三次握手过程：</p>
<p>1、Client 端向 Server 端发送 SYN 发起握手，Client 端进入 SYN_SENT 状态</p>
<p>2、Server 端收到 Client 端的 SYN 请求后，Server 端进入 SYN_RECV 状态，此时内核会将连接存储到半连接队列(SYN Queue)，并向 Client 端回复 SYN+ACK</p>
<p>3、Client 端收到 Server 端的 SYN+ACK 后，Client 端回复 ACK 并进入 ESTABLISHED 状态</p>
<p>4、Server 端收到 Client 端的 ACK 后，内核将连接从半连接队列(SYN Queue)中取出，添加到全连接队列(Accept Queue)，Server 端进入 ESTABLISHED 状态</p>
<p>5、Server 端应用进程调用 accept 函数时，将连接从全连接队列(Accept Queue)中取出</p>
<p>半连接队列和全连接队列都有长度大小限制，超过限制时内核会将连接 Drop 丢弃或者返回 RST 包。</p>
<h2 id="_3">相关指标查看<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="ss">ss 命令<a class="headerlink" href="#ss" title="Permanent link">&para;</a></h3>
<p>通过 ss 命令可以查看到全连接队列的信息</p>
<p>复制</p>
<div class="highlight"><pre><span></span><code><span class="c1"># -n 不解析服务名称 </span>
<span class="c1"># -t 只显示 tcp sockets </span>
<span class="c1"># -l 显示正在监听(LISTEN)的 sockets </span>

$<span class="w"> </span>ss<span class="w"> </span>-lnt<span class="w"> </span>
State<span class="w">      </span>Recv-Q<span class="w"> </span>Send-Q<span class="w">    </span>Local<span class="w"> </span>Address:Port<span class="w">         </span>Peer<span class="w"> </span>Address:Port<span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">       </span><span class="o">[</span>::<span class="o">]</span>:2380<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">       </span><span class="o">[</span>::<span class="o">]</span>:80<span class="w">                    </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">       </span><span class="o">[</span>::<span class="o">]</span>:8080<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">       </span><span class="o">[</span>::<span class="o">]</span>:8090<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>

$<span class="w"> </span>ss<span class="w"> </span>-nt<span class="w"> </span>
State<span class="w">      </span>Recv-Q<span class="w"> </span>Send-Q<span class="w">    </span>Local<span class="w"> </span>Address:Port<span class="w">         </span>Peer<span class="w"> </span>Address:Port<span class="w"> </span>
ESTAB<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">         </span><span class="o">[</span>::ffff:33.9.95.134<span class="o">]</span>:80<span class="w">                   </span><span class="o">[</span>::ffff:33.51.103.59<span class="o">]</span>:47452<span class="w"> </span>
ESTAB<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">536</span><span class="w">       </span><span class="o">[</span>::ffff:33.9.95.134<span class="o">]</span>:80<span class="w">                  </span><span class="o">[</span>::ffff:33.43.108.144<span class="o">]</span>:37656<span class="w"> </span>
ESTAB<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">         </span><span class="o">[</span>::ffff:33.9.95.134<span class="o">]</span>:80<span class="w">                   </span><span class="o">[</span>::ffff:33.51.103.59<span class="o">]</span>:38130<span class="w"> </span>
ESTAB<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">536</span><span class="w">       </span><span class="o">[</span>::ffff:33.9.95.134<span class="o">]</span>:80<span class="w">                   </span><span class="o">[</span>::ffff:33.51.103.59<span class="o">]</span>:38280<span class="w"> </span>
ESTAB<span class="w">      </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w">         </span><span class="o">[</span>::ffff:33.9.95.134<span class="o">]</span>:80<span class="w">                   </span><span class="o">[</span>::<span class="w"> </span>
</code></pre></div>
<h3 id="listen-socket">对于 LISTEN 状态的 socket<a class="headerlink" href="#listen-socket" title="Permanent link">&para;</a></h3>
<ul>
<li>Recv-Q：当前全连接队列的大小，即已完成三次握手等待应用程序 accept() 的 TCP 链接</li>
<li>Send-Q：全连接队列的最大长度，即全连接队列的大小</li>
</ul>
<h3 id="listen-socket_1">对于非 LISTEN 状态的 socket<a class="headerlink" href="#listen-socket_1" title="Permanent link">&para;</a></h3>
<ul>
<li>Recv-Q：已收到但未被应用程序读取的字节数</li>
<li>Send-Q：已发送但未收到确认的字节数</li>
</ul>
<p>相关内核代码：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_diag.c </span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">tcp_diag_get_info</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">sock</span><span class="w"> </span><span class="o">*</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">inet_diag_msg</span><span class="w"> </span><span class="o">*</span><span class="n">r</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">_info</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">tcp_info</span><span class="w"> </span><span class="o">*</span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_info</span><span class="p">;</span><span class="w"> </span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">inet_sk_state_load</span><span class="p">(</span><span class="n">sk</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">TCP_LISTEN</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// socket 状态是 LISTEN 时 </span>
<span class="w">    </span><span class="n">r</span><span class="o">-&gt;</span><span class="n">idiag_rqueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_ack_backlog</span><span class="p">);</span><span class="w">  </span><span class="c1">// 当前全连接队列大小 </span>
<span class="w">    </span><span class="n">r</span><span class="o">-&gt;</span><span class="n">idiag_wqueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_max_ack_backlog</span><span class="p">);</span><span class="w"> </span><span class="c1">// 全连接队列最大长度 </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SOCK_STREAM</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span><span class="c1">// socket 状态不是 LISTEN 时 </span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">tcp_sock</span><span class="w"> </span><span class="o">*</span><span class="n">tp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcp_sk</span><span class="p">(</span><span class="n">sk</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="n">r</span><span class="o">-&gt;</span><span class="n">idiag_rqueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max_t</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">tp</span><span class="o">-&gt;</span><span class="n">rcv_nxt</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span>
<span class="w">               </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">tp</span><span class="o">-&gt;</span><span class="n">copied_seq</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">    </span><span class="c1">// 已收到但未被应用程序读取的字节数 </span>
<span class="w">    </span><span class="n">r</span><span class="o">-&gt;</span><span class="n">idiag_wqueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">tp</span><span class="o">-&gt;</span><span class="n">write_seq</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">tp</span><span class="o">-&gt;</span><span class="n">snd_una</span><span class="p">;</span><span class="w">   </span><span class="c1">// 已发送但未收到确认的字节数 </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="n">tcp_get_info</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">);</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p><strong>netstat 命令</strong></p>
<p>通过 netstat -s 命令可以查看 TCP 半连接队列、全连接队列的溢出情况</p>
<p>复制</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>netstat<span class="w"> </span>-s<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;listen&quot;</span><span class="w"> </span>
<span class="w">    </span><span class="m">189088</span><span class="w"> </span><span class="nb">times</span><span class="w"> </span>the<span class="w"> </span>listen<span class="w"> </span>queue<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>socket<span class="w"> </span>overflowed<span class="w"> </span>
<span class="w">    </span><span class="m">30140232</span><span class="w"> </span>SYNs<span class="w"> </span>to<span class="w"> </span>LISTEN<span class="w"> </span>sockets<span class="w"> </span>dropped<span class="w"> </span>
</code></pre></div>
<p>上面输出的数值是累计值，分别表示有多少 TCP socket 链接因为全连接队列、半连接队列满了而被丢弃</p>
<ul>
<li><code>189088 times the listen queue of a socket overflowed</code> 代表有 189088 次全连接队列溢出</li>
<li><code>30140232 SYNs to LISTEN sockets dropped</code> 代表有 30140232 次半连接队列溢出</li>
</ul>
<p>在排查线上问题时，如果一段时间内相关数值一直在上升，则表明半连接队列、全连接队列有溢出情况</p>
<h2 id="_4">全连接队列实战<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<h3 id="_5">最大长度控制<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>TCP 全连接队列的最大长度由 <span class="arithmatex">\(min(somaxconn, backlog)\)</span> 控制，其中：</p>
<ul>
<li>somaxconn 是 Linux 内核参数，由 <code>/proc/sys/net/core/somaxconn</code> 指定</li>
<li>backlog 是 TCP 协议中 listen 函数的参数之一，即 <code>int listen(int sockfd, int backlog)</code> 函数中的 backlog 大小。在 Golang 中，listen 的 backlog 参数使用的是 <code>/proc/sys/net/core/somaxconn</code> 文件中的值。</li>
</ul>
<p>相关内核代码：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// https://github.com/torvalds/linux/blob/master/net/socket.c </span>

<span class="cm">/* </span>
<span class="cm"> *  Perform a listen. Basically, we allow the protocol to do anything </span>
<span class="cm"> *  necessary for a listen, and if that works, we mark the socket as </span>
<span class="cm"> *  ready for listening. </span>
<span class="cm"> */</span><span class="w"> </span>
<span class="kt">int</span><span class="w"> </span><span class="nf">__sys_listen</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">backlog</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">socket</span><span class="w"> </span><span class="o">*</span><span class="n">sock</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="n">fput_needed</span><span class="p">;</span><span class="w"> </span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">somaxconn</span><span class="p">;</span><span class="w"> </span>

<span class="w">  </span><span class="n">sock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sockfd_lookup_light</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">err</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fput_needed</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sock</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="n">somaxconn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sock_net</span><span class="p">(</span><span class="n">sock</span><span class="o">-&gt;</span><span class="n">sk</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">core</span><span class="p">.</span><span class="n">sysctl_somaxconn</span><span class="p">;</span><span class="w">  </span><span class="c1">// /proc/sys/net/core/somaxconn </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="n">backlog</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">somaxconn</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="n">backlog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">somaxconn</span><span class="p">;</span><span class="w">   </span><span class="c1">// TCP 全连接队列最大长度 min(somaxconn, backlog) </span>

<span class="w">    </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">security_socket_listen</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">backlog</span><span class="p">);</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="n">err</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sock</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">listen</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span><span class="w"> </span><span class="n">backlog</span><span class="p">);</span><span class="w"> </span>

<span class="w">    </span><span class="n">fput_light</span><span class="p">(</span><span class="n">sock</span><span class="o">-&gt;</span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">fput_needed</span><span class="p">);</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">err</span><span class="p">;</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<h3 id="_6">实验<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>服务端 server 代码</p>
<div class="highlight"><pre><span></span><code><span class="c1">// server.go</span>
<span class="c1">// go build server.go</span>
<span class="c1">// ./server</span>
<span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;net&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"> </span>
<span class="p">)</span><span class="w"> </span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">l</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8888&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;failed to listen due to %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">defer</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;listen :8888 success&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>在测试环境查看 somaxconn 的值为 128</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>/proc/sys/net/core/somaxconn<span class="w"> </span>
<span class="m">128</span><span class="w"> </span>
</code></pre></div>
<p>启动服务端，通过 <code>ss -lnt | grep :8888</code> 确认全连接队列大小</p>
<div class="highlight"><pre><span></span><code>LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">       </span><span class="o">[</span>::<span class="o">]</span>:8888<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
</code></pre></div>
<p>全连接队列最大长度为 128</p>
<p>现在更新 somaxconn 值为 1024，再重新启动服务端。</p>
<ol>
<li>更新 <code>/etc/sysctl.conf</code> 文件，该文件为内核参数配置文件</li>
<li>新增一行 <code>net.core.somaxconn=1024</code></li>
<li>
<p>执行 <code>sysctl -p</code> 使配置生效
  <div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-p<span class="w"> </span>
net.core.somaxconn<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1024</span><span class="w"> </span>
</code></pre></div></p>
</li>
<li>
<p>检查 <code>/proc/sys/net/core/somaxconn</code> 文件，确认 somaxconn 为更新后的 1024
  <div class="highlight"><pre><span></span><code>$<span class="w"> </span>cat<span class="w"> </span>/proc/sys/net/core/somaxconn<span class="w"> </span>
<span class="m">1024</span><span class="w"> </span>
</code></pre></div></p>
</li>
</ol>
<p>重新启动服务端， 通过 <code>ss -lnt | grep :8888</code> 确认全连接队列大小</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ss<span class="w"> </span>-lnt<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">8888</span><span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">1024</span><span class="w">      </span><span class="o">[</span>::<span class="o">]</span>:8888<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
</code></pre></div>
<p>可以看到，现在全链接队列最大长度为 1024，成功更新。</p>
<h3 id="_7">全连接队列溢出<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>下面来验证下全连接队列溢出会发生什么情况，可以通过让服务端应用只负责 Listen 对应端口而不执行 accept() TCP 连接，使 TCP 全连接队列溢出。</p>
<p><strong>实验物料</strong></p>
<p>服务端 server 代码</p>
<div class="highlight"><pre><span></span><code><span class="c1">// server 端监听 8888 tcp 端口 </span>

<span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;net&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"> </span>
<span class="p">)</span><span class="w"> </span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">l</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">Listen</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8888&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;failed to listen due to %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">defer</span><span class="w"> </span><span class="nx">l</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span><span class="w"> </span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;listen :8888 success&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>客户端 client 代码</p>
<div class="highlight"><pre><span></span><code><span class="c1">// client 端并发请求 10 次 server 端，成功建立 tcp 连接后向 server 端发送数据 </span>
<span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;context&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;log&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;net&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;os&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;os/signal&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;sync&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;syscall&quot;</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;time&quot;</span><span class="w"> </span>
<span class="p">)</span><span class="w"> </span>

<span class="kd">var</span><span class="w"> </span><span class="nx">wg</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span><span class="w"> </span>

<span class="kd">func</span><span class="w"> </span><span class="nx">establishConn</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">defer</span><span class="w"> </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span><span class="w"> </span>
<span class="w">  </span><span class="nx">conn</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">net</span><span class="p">.</span><span class="nx">DialTimeout</span><span class="p">(</span><span class="s">&quot;tcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:8888&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d, dial error: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d, dial success&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">conn</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">))</span><span class="w"> </span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d, send error: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">Done</span><span class="p">():</span><span class="w"> </span>
<span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d, dail close&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>

<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">())</span><span class="w"> </span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">establishConn</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span>

<span class="w">  </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="nx">sc</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="nx">signal</span><span class="p">.</span><span class="nx">Notify</span><span class="p">(</span><span class="nx">sc</span><span class="p">,</span><span class="w"> </span><span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">sc</span><span class="p">:</span><span class="w"> </span>
<span class="w">      </span><span class="nx">cancel</span><span class="p">()</span><span class="w"> </span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">  </span><span class="p">}()</span><span class="w"> </span>

<span class="w">  </span><span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span><span class="w"> </span>
<span class="w">  </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;client exit&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>为了方便实验，将 somaxconn 全连接队列最大长度更新为 5：</p>
<ol>
<li>
<p>更新 <code>/etc/sysctl.conf</code>文件，将 <code>net.core.somaxconn</code> 更新为 5</p>
</li>
<li>
<p>执行 sysctl -p 使配置生效</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-p<span class="w"> </span>
net.core.somaxconn<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="w"> </span>
</code></pre></div>
<p><strong>实验结果</strong></p>
<p>客户端日志输出</p>
<div class="highlight"><pre><span></span><code><span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">8</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">3</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">4</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">6</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">5</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">2</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:48<span class="w"> </span><span class="m">7</span>,<span class="w"> </span>dial<span class="w"> </span>success<span class="w"> </span>
<span class="m">2021</span>/10/11<span class="w"> </span><span class="m">17</span>:24:53<span class="w"> </span><span class="m">9</span>,<span class="w"> </span>dial<span class="w"> </span>error:<span class="w"> </span>dial<span class="w"> </span>tcp<span class="w"> </span><span class="m">33</span>.9.192.157:8888:<span class="w"> </span>i/o<span class="w"> </span>timeout<span class="w"> </span>
</code></pre></div>
<p>客户端 socket 情况</p>
<div class="highlight"><pre><span></span><code>tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40372<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40376<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40370<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40366<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40374<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
tcp<span class="w">        </span><span class="m">0</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.155:40368<span class="w">      </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span>ESTABLISHED<span class="w"> </span>
</code></pre></div>
<p>服务端 socket 情况</p>
<div class="highlight"><pre><span></span><code>tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40376<span class="w">      </span>ESTABLISHED<span class="w"> </span>
tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40370<span class="w">      </span>ESTABLISHED<span class="w"> </span>
tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40368<span class="w">      </span>ESTABLISHED<span class="w"> </span>
tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40372<span class="w">      </span>ESTABLISHED<span class="w"> </span>
tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40374<span class="w">      </span>ESTABLISHED<span class="w"> </span>
tcp6<span class="w">      </span><span class="m">11</span><span class="w">      </span><span class="m">0</span><span class="w"> </span><span class="m">33</span>.9.192.157:8888<span class="w">       </span><span class="m">33</span>.9.192.155:40366<span class="w">      </span>ESTABLISHED<span class="w"> </span>

tcp<span class="w">    </span>LISTEN<span class="w">     </span><span class="m">6</span><span class="w">      </span><span class="m">5</span><span class="w">      </span><span class="o">[</span>::<span class="o">]</span>:8888<span class="w">               </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w">                   </span>users:<span class="o">((</span><span class="s2">&quot;main&quot;</span>,pid<span class="o">=</span><span class="m">84244</span>,fd<span class="o">=</span><span class="m">3</span><span class="o">))</span><span class="w"> </span>
</code></pre></div>
<p>抓包结果</p>
<p>对客户端、服务端抓包后，发现出现了三种情况，分别是：</p>
<ul>
<li>client 成功与 server 端建立 tcp socket 连接，发送数据成功</li>
<li>client 认为成功与 server 端建立 tcp socket 连接，发送数据失败，一直在 RETRY;server 端认为 tcp 连接未建立，一直在发送 SYN+ACK</li>
<li>client 向 server 发送 SYN 未得到响应，一直在 RETRY</li>
</ul>
<p><strong>全连接队列实验结果分析</strong></p>
<p>上述实验结果出现了三种情况，我们分别对抓包内容进行分析</p>
<p>抓包程序使用 <a href="https://www.wireshark.org/">tshark</a>，抓包命令如下：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w">  </span>tshark<span class="w"> </span>-Eheader<span class="o">=</span>y<span class="w"> </span>-l<span class="w">   </span>-f<span class="w"> </span><span class="s2">&quot;tcp port 8888&quot;</span><span class="w"> </span>-i<span class="w"> </span>any
</code></pre></div>
<p><strong>情况一：Client 成功与 Server 端建立 tcp socket 链接，发送数据成功</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">No.</th>
<th>Source</th>
<th>Destination</th>
<th>Protocol</th>
<th>length</th>
<th>info</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>TCP</td>
<td>80</td>
<td>61170 → 8888 [<font color='red'>SYN</font>] Seq=0 Win=65535 Len=0 MSS=1460 WS=64 TSval=1184189553 TSecr=0 SACK_PERM=1</td>
</tr>
<tr>
<td style="text-align: left;">9</td>
<td>192.168.31.76</td>
<td>192.168.31.205</td>
<td>TCP</td>
<td>76</td>
<td>8888 → 61170 [<font color='red'>SYN, ACK</font>] Seq=0 Ack=1 Win=65160 Len=0 MSS=1460 SACK_PERM=1 TSval=648136459 TSecr=1184189553 WS=128</td>
</tr>
<tr>
<td style="text-align: left;">29</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>TCP</td>
<td>68</td>
<td>61170 → 8888 [<font color='red'>ACK</font>] Seq=1 Ack=1 Win=131712 Len=0 TSval=1184189706 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">32</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>TCP</td>
<td>79</td>
<td>61170 → 8888 [<font color='red'>PSH, ACK</font>] Seq=1 Ack=1 Win=131712 Len=11 TSval=1184189706 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">38</td>
<td>192.168.31.76</td>
<td>192.168.31.205</td>
<td>TCP</td>
<td>68</td>
<td>8888 → 61170 [<font color='red'>ACK</font>] Seq=1 Ack=12 Win=65152 Len=0 TSval=648136464 TSecr=1184189706</td>
</tr>
</tbody>
</table>
<p>上面的表格是通过抓包数据后进行了整理，<code>No.</code> 列是抓包中实际的序号，我这里把一个连接所涉及的包整理在一块，方便分析。</p>
<p>上表可以看到如下请求：</p>
<ul>
<li>Client 端(192.168.31.205)  向 Server 端(192.168.31.76) 发送 SYN 发起握手</li>
<li>Server 端收到 Client 端 SYN 后，向 Client 端回复 <code>SYN+ACK</code>，socket 连接存储到半连接队列(SYN Queue)</li>
<li>Client 端收到 Server 端 <code>SYN+ACK</code> 后，向 Server 端回复 ACK，Client 端进入 ESTABLISHED 状态</li>
<li>Server 端收到 Client 端 ACK 后，进入 ESTABLISHED 状态，socket 连接存储到全连接队列(Accept Queue)</li>
<li>Client 端向 Server 端发送数据 [PSH, ACK]，Server 端确认接收到数据 [ACK]</li>
</ul>
<p>这种情况就是正常的请求，即全连接队列、半连接队列未满，client 成功与 server 建立了 tcp 链接，并成功发送数据。</p>
<p><strong>情况二：Client 认为成功与 Server 端建立 tcp socket 连接，后续发送数据失败，持续 RETRY;Server 端认为 TCP 连接未建立，一直在发送SYN+ACK</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">No.</th>
<th>Source</th>
<th>Destination</th>
<th>info</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">8</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>61177 → 8888 [SYN] Seq=0 Win=65535 Len=0 MSS=1460 WS=64 TSval=4039865585 TSecr=0 SACK_PERM=1</td>
</tr>
<tr>
<td style="text-align: left;">11</td>
<td>192.168.31.76</td>
<td>192.168.31.205</td>
<td>8888 → 61177 [SYN, ACK] Seq=0 Ack=1 Win=65160 Len=0 MSS=1460 SACK_PERM=1 TSval=648136459 TSecr=4039865585 WS=128</td>
</tr>
<tr>
<td style="text-align: left;">39</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>61177 → 8888 [ACK] Seq=1 Ack=1 Win=131712 Len=0 TSval=4039865738 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">40</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>61177 → 8888 [PSH, ACK] Seq=1 Ack=1 Win=131712 Len=11 TSval=4039865738 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">47</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>[TCP Retransmission] 61177 → 8888 [PSH, ACK] Seq=1 Ack=1 Win=131712 Len=11 TSval=4039865969 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">51</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>[TCP Retransmission] 61177 → 8888 [PSH, ACK] Seq=1 Ack=1 Win=131712 Len=11 TSval=4039866438 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">55</td>
<td>192.168.31.76</td>
<td>192.168.31.205</td>
<td>[TCP Retransmission] 8888 → 61177 [SYN, ACK] Seq=0 Ack=1 Win=65160 Len=0 MSS=1460 SACK_PERM=1 TSval=648137479 TSecr=4039866438 WS=128</td>
</tr>
<tr>
<td style="text-align: left;">63</td>
<td>192.168.31.205</td>
<td>192.168.31.76</td>
<td>[TCP Retransmission] 61177 → 8888 [PSH, ACK] Seq=1 Ack=1 Win=131712 Len=11 TSval=4039868453 TSecr=648136459</td>
</tr>
<tr>
<td style="text-align: left;">65</td>
<td>192.168.31.76</td>
<td>192.168.31.205</td>
<td>[TCP Retransmission] 8888 → 61177 [SYN, ACK] Seq=0 Ack=1 Win=65160 Len=0 MSS=1460 SACK_PERM=1 TSval=648139495 TSecr=4039868453 WS=128</td>
</tr>
</tbody>
</table>
<p>上表可以看到如下请求：</p>
<ul>
<li>Client 端向 Server 端发送 SYN 发起握手</li>
<li>Server 端收到 Client 端 SYN 后，向 Client 端回复 <code>SYN+ACK</code>，socket 连接存储到半连接队列(SYN Queue)</li>
<li>Client 端收到 Server 端 <code>SYN+ACK</code> 后，向 Server 端回复 ACK，Client 端进入 ESTABLISHED状态(重要：此时仅仅是 Client 端认为 tcp 连接建立成功)</li>
<li>由于 Client 端认为 TCP 连接已经建立完成，所以向 Server 端发送数据 <code>[PSH，ACK]</code>，但是一直未收到 Server 端的确认 ACK，所以一直在 RETRY</li>
<li>Server 端一直在 RETRY 发送 <code>SYN+ACK</code></li>
</ul>
<p>为什么会出现上述情况？</p>
<p>Server 端为什么一直在 RETRY 发送 <code>SYN+ACK</code>?</p>
<p>Server 端不是已经收到了 Client 端的 ACK 确认了吗?</p>
<p>上述情况是由于 Server 端 socket 连接进入了半连接队列，在收到 Client 端 ACK 后，本应将 socket 连接存储到全连接队列，但是全连接队列已满，所以 Server 端 DROP 了该 ACK 请求。</p>
<p>之所以 Server 端一直在 RETRY 发送 <code>SYN+ACK</code>，是因为 DROP 了 client 端的 ACK 请求，所以 socket 连接仍旧在半连接队列中，等待 Client 端回复 ACK。</p>
<p>全连接队列满 DROP 请求是默认行为，可以通过设置 <code>/proc/sys/net/ipv4/tcp_abort_on_overflow</code> 使 Server 端在全连接队列满时，向 Client 端发送 RST 报文。</p>
<p><code>tcp_abort_on_overflow</code> 有两种可选值：</p>
<ul>
<li>0：如果全连接队列满了，Server 端 DROP Client 端回复的 ACK</li>
<li>1：如果全连接队列满了，Server 端向 Client 端发送 RST 报文，终止 TCP socket 链接 </li>
</ul>
<p><strong>为什么实验结果中当前全连接队列大小 &gt; 全连接队列最大长度配置?</strong></p>
<p>上述结果中可以看到 Listen 状态的 socket 链接：</p>
<ul>
<li>Recv-Q 当前全连接队列的大小是 6</li>
<li>Send-Q 全连接队列最大长度是 5</li>
</ul>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>ss<span class="w"> </span>-ln<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">&#39;(State|:8888)&#39;</span>
State<span class="w">      </span>Recv-Q<span class="w"> </span>Send-Q<span class="w">    </span>Local<span class="w"> </span>Address:Port<span class="w">         </span>Peer<span class="w"> </span>Address:Port<span class="w"> </span>
LISTEN<span class="w">     </span><span class="m">6</span><span class="w">      </span><span class="m">5</span><span class="w">         </span><span class="o">[</span>::<span class="o">]</span>:8888<span class="w">                  </span><span class="o">[</span>::<span class="o">]</span>:*<span class="w"> </span>
</code></pre></div>
<p>为什么全连接队列大小 &gt; 全连接队列最大长度配置呢?</p>
<p>经过多次实验发现，能够进入全连接队列的 Socket 最大数量始终比配置的全连接队列最大长度 + 1。</p>
<p>结合其他文章以及内核代码，发现内核在判断全连接队列是否满的情况下，使用的是 <code>&gt;</code> 而非 <code>&gt;=</code> 。</p>
<p>相关内核代码：</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* Note: If you think the test should be: </span>
<span class="cm"> *  return READ_ONCE(sk-&gt;sk_ack_backlog) &gt;= READ_ONCE(sk-&gt;sk_max_ack_backlog); </span>
<span class="cm"> * Then please take a look at commit 64a146513f8f (&quot;[NET]: Revert incorrect accept queue backlog changes.&quot;) </span>
<span class="cm"> */</span><span class="w"> </span>
<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">sk_acceptq_is_full</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sock</span><span class="w"> </span><span class="o">*</span><span class="n">sk</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_ack_backlog</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">READ_ONCE</span><span class="p">(</span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_max_ack_backlog</span><span class="p">);</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p><strong>情况三：Client 向 Server 发送 SYN 未得到相应，一直在 RETRY</strong></p>
<p>图片上图可以看到如下请求：</p>
<ul>
<li>Client 端向 Server 端发送 SYN 发起握手，未得到 Server 回应，一直在 RETRY</li>
</ul>
<p>(这种情况涉及到半连接队列，这里先给上述情况发生的原因结论，具体内容将在下文半连接队列中展开。)</p>
<p>发生上述情况的原因由以下两方面导致：</p>
<p>1、开启了 <code>/proc/sys/net/ipv4/tcp_syncookies</code> 功能</p>
<p>2、全连接队列满了</p>
<h2 id="_8">半连接队列实战<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<h3 id="_9">半连接队列最大长度控制<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>翻阅了很多博文，查找关于半连接队列最大长度控制的相关内容，大多含糊其辞或不准确，经过不懈努力，最终找到了比较确切的内容(相关博文链接在附录中)。</p>
<p>很多博文中说半连接队列最大长度由 <code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code> 参数指定，实际上只有在 linux 内核版本小于 <code>2.6.20</code> 时，半连接队列才等于 backlog 的大小。</p>
<p>这块的源码比较复杂，这里给一下大体的计算方式，详细的内容可以参考附录中的相关博文。半连接队列长度的计算过程：</p>
<div class="arithmatex">\[
\begin{align}
qlen &amp;= max(min(somaxconn, backlog, sysctl\_max\_syn\_backlog), 8)  \\ 
&amp;// roundup\_pow\_of\_two: 将参数向上取整到最小的 2^n，注意这里存在一个 +1  \\
qlen &amp;= roundup\_pow\_of\_two(qlen + 1)  \\ 
max\_qlen\_log &amp;= max(3, log_2(qlen))  \\
max\_queue\_length &amp;= 2^{max\_qlen\_log} \\
\end{align}
\]</div>
<p>可以看到，半连接队列的长度由三个参数指定：</p>
<ul>
<li>调用 listen 时，传入的 backlog</li>
<li><code>/proc/sys/net/core/somaxconn</code> 默认值为 128</li>
<li><code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code> 默认值为 1024</li>
</ul>
<p>我们假设 listen 传入的 <code>backlog = 128</code> (Golang 中调用 listen 时传递的 backlog 参数使用的是 <code>/proc/sys/net/core/somaxconn</code>)，其他配置采用默认值，来计算下半连接队列的最大长度</p>
<div class="arithmatex">\[
\begin{align}
qlen &amp;= max(min(somaxconn, backlog, sysctl\_max\_syn\_backlog), 8) \\
         &amp;= max(min(128, 128, 1024), 8) \\
         &amp;= 128 \\ 
qlen &amp;= roundup\_pow\_of\_two(qlen + 1) \\
            &amp;= roundup\_pow\_of\_two(128 + 1) \\
         &amp;= 256 \\ 
max\_qlen\_log &amp;= max(3, log_2{qlen}) \\
  &amp;= max(3, 8) \\
  &amp; = 8 \\ 
max\_queue\_length &amp;= 2^{max\_qlen\_log} \\
   &amp;= 2^8 \\
   &amp;= 256 \\ 
\end{align}
\]</div>
<p>可以得到半队列大小是 256。</p>
<h3 id="drop-syn"><strong>判断是否 Drop SYN 请求</strong><a class="headerlink" href="#drop-syn" title="Permanent link">&para;</a></h3>
<p>当 Client 端向 Server 端发送 SYN 报文后，Server 端会将该 socket 连接存储到半连接队列(SYN Queue)，如果 Server 端判断半连接队列满了则会将连接 Drop 丢弃。</p>
<p>那么 Server 端是如何判断半连接队列是否满的呢?除了上面一小节提到的半连接队列最大长度控制外，还和 <code>/proc/sys/net/ipv4/tcp_syncookies</code> 参数有关。(<code>tcp_syncookies</code> 的作用是为了防止 SYN Flood 攻击的，下文会给出相关链接介绍)</p>
<p><strong>流程图</strong></p>
<p>判断是否 Drop SYN 请求的流程图：</p>
<pre class="mermaid"><code>graph TD
%%cur_qlen 当前半连接队列长度, max_qlen 半连接队列最大长度%%
c1{"cur_qlen &gt;= max_qlen"}
c2{"是否开启了&lt;br/&gt;tcp_syncookies"}
c3{"当前全队列是否已满"}
c4{"半连接队列没有重传&lt;br/&gt;SYN+ACK的连接请求&gt;1"}
c5{"是否开启了&lt;br/&gt;tcp_syncookies"}
c6{"(tcp_max_syn_backlog - cur_qlen ) &lt;br/&gt;&lt; (tcp_max_sync_backlog)&gt;&gt;2"}
drop("Drop SYN 请求")
ack("响应 SYN+ACK")

c1 -- 是 --&gt; c2
c1 -- 否 --&gt; c3
c3 -- 是 --&gt; c4
c3 -- 否 --&gt; c5
c5 -- 是 ---&gt;ack
c5 -- 否 --&gt; c6

c2 -- 否 --&gt; drop
c4 -- 是 --&gt; drop
c6 -- 是 --&gt; drop

style drop fill:#fbcfcd,stroke-width:0px,color:white;
style ack fill:#12e7d4,stroke-width:0px,color:white;</code></pre>
<p>图列说明：</p>
<ul>
<li><code>cur_qlen</code>: 当前半连接队列长度</li>
<li><code>max_qlen</code>: 全连接队列最大长度</li>
<li></li>
</ul>
<p>上图是整理了多份资料后，整理出来的判断是否 Drop SYN 请求的流程图。</p>
<p>相关内核代码：</p>
<div class="highlight"><pre><span></span><code><span class="c1">// include/net/inet_connection_sock.h </span>
<span class="c1">// line: 281</span>
<span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">inet_csk_reqsk_queue_is_full</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">sock</span><span class="w"> </span><span class="o">*</span><span class="n">sk</span><span class="p">)</span><span class="w"> </span>
<span class="p">{</span><span class="w"> </span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">inet_csk_reqsk_queue_len</span><span class="p">(</span><span class="n">sk</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">sk</span><span class="o">-&gt;</span><span class="n">sk_max_ack_backlog</span><span class="p">;</span><span class="w"> </span>
<span class="p">}</span><span class="w"> </span>
</code></pre></div>
<p>其中 <code>tcp(7)</code> 手册上是这样描述 <code>tcp_syn_cookies</code></p>
<blockquote>
<p>tcp_syncookies (integer; default: 1; since Linux 2.2)<br />
 Enable TCP syncookies.  The kernel must be compiled with CONFIG_SYN_COOKIES.   The  syn‐<br />
 cookies  feature  attempts  to protect a socket from a SYN flood attack.  This should be<br />
 used as a last resort, if at all.  This is a violation of the  TCP  protocol,  and  con‐<br />
 flicts  with  other  areas  of  TCP  such  as TCP extensions.  It can cause problems for<br />
 clients and relays.  It is not recommended as a  tuning  mechanism  for  heavily  loaded<br />
 servers  to  help with overloaded or misconfigured conditions.  For recommended alterna‐<br />
 tives see tcp_max_syn_backlog, tcp_synack_retries, and  tcp_abort_on_overflow.   Set  to<br />
 one of the following values:<br />
 0  Disable TCP syncookies<br />
 1  Send out syncookies when the syn backlog queue of a socket overflows  <br />
 2  (since  Linux 3.12) Send out syncookies unconditionally.  This can be useful for net‐
    work testing.  </p>
</blockquote>
<p>我们假设如下参数，来计算下当 Client 端只发送 SYN 包，理论上 Server 端何时会 Drop SYN 请求：</p>
<table>
<thead>
<tr>
<th>backlog</th>
<th>somaxconn</th>
<th><code>tcp_max_syn_backlog</code></th>
<th><code>tcp_syncookies</code></th>
<th>半队列最大长度</th>
<th>触发 Drop SYN 临界值</th>
</tr>
</thead>
<tbody>
<tr>
<td>1024</td>
<td>1024</td>
<td>128</td>
<td>0</td>
<td>256</td>
<td>96</td>
</tr>
<tr>
<td>1024</td>
<td>1024</td>
<td>128</td>
<td>1</td>
<td>256</td>
<td>512/1024<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></td>
</tr>
<tr>
<td>1024</td>
<td>1024</td>
<td>128</td>
<td>2</td>
<td>256</td>
<td>永不</td>
</tr>
</tbody>
</table>
<p><strong>回顾全连接队列实验结果</strong></p>
<p>在上文全连接队列实验中，有一类实验结果是：client 向 Server 发送 SYN 未得到响应，一直在 RETRY。</p>
<p>发生上述情况的原因由以下两方面导致：</p>
<ol>
<li>开启了 <code>/proc/sys/net/ipv4/tcp_syncookies</code> 功能</li>
<li>全连接队列满了</li>
</ol>
<p><strong>半连接队列溢出实验</strong></p>
<p>上文我们已经知道如何计算理论上半连接队列何时会溢出，下面我们来具体实验下</p>
<p>(Golang 调用 listen 时传入的 backlog 值为 somaxconn)</p>
<h3 id="_10">实验一<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>将相关参数的配置更新</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.core.somaxconn<span class="o">=</span><span class="m">1024</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_max_syn_backlog<span class="o">=</span><span class="m">128</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_syncookies<span class="o">=</span><span class="m">0</span><span class="w"> </span>
</code></pre></div>
<p>理论上：</p>
<ul>
<li>计算出的半连接队列最大长度为 256</li>
<li>当半连接队列长度增长至 96 后，后续 SYN 请求就会触发 Drop</li>
</ul>
<p>启动服务端 Server 监听 8888 端口</p>
<p>客户端 Client 发起 SYN Flood 攻击：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>hping3<span class="w"> </span>-S<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span><span class="w"> </span>--flood<span class="w"> </span>
HPING<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span><span class="o">(</span>wlp0s20f3<span class="w"> </span><span class="m">192</span>.168.31.76<span class="o">)</span>:<span class="w"> </span>S<span class="w"> </span>set,<span class="w"> </span><span class="m">40</span><span class="w"> </span>headers<span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>data<span class="w"> </span>bytes
hping<span class="w"> </span><span class="k">in</span><span class="w"> </span>flood<span class="w"> </span>mode,<span class="w"> </span>no<span class="w"> </span>replies<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>shown<span class="w"> </span>
</code></pre></div>
<p>查看服务端 Server 8888端口处于 <code>SYN_RECV</code> 状态的 socket 最大个数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;SYN_RECV&#39;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">98</span>
$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;SYN_RECV&#39;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">98</span>
</code></pre></div>
<p>我这里实验结果（98）和预期（96）有相差，具体原因还没有找到，当半连接队列长度增长至 98 后，后续 SYN 请求就会触发 Drop。</p>
<h3 id="_11">实验二<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>将相关参数的配置更新</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.core.somaxconn<span class="o">=</span><span class="m">128</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_max_syn_backlog<span class="o">=</span><span class="m">512</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_syncookies<span class="o">=</span><span class="m">0</span><span class="w"> </span>
</code></pre></div>
<p>理论上：</p>
<ul>
<li>计算出的半连接队列最大长度为 256，由于笔者实验机器上的内核版本是 5.19.0，所以当半连接队列长度 &gt;= 全连接队列最大长度时，内核就认为半连接队列溢出了</li>
<li>所以当半连接队列长度增长至 128 后，后续 SYN 请求就会触发 DROP</li>
</ul>
<p>启动服务端 Server 监听 8888 端口(代码参考全连接队列实验物料)</p>
<p>客户端 Client 发起 SYN Flood 攻击：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>hping3<span class="w"> </span>-S<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span><span class="w"> </span>--flood<span class="w"> </span>
HPING<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span><span class="o">(</span>en1<span class="w"> </span><span class="m">192</span>.168.31.76<span class="o">)</span>:<span class="w"> </span>S<span class="w"> </span>set,<span class="w"> </span><span class="m">40</span><span class="w"> </span>headers<span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>data<span class="w"> </span>bytes
hping<span class="w"> </span><span class="k">in</span><span class="w"> </span>flood<span class="w"> </span>mode,<span class="w"> </span>no<span class="w"> </span>replies<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>shown
</code></pre></div>
<p>查看服务端 Server 8888 端口处于 SYN_RECV 状态的 socket 最大个数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">128</span><span class="w"> </span>

$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">128</span><span class="w"> </span>
</code></pre></div>
<p>实验结果符合预期，当半连接队列长度增长至 128 后，后续 SYN 请求就会触发 Drop</p>
<h3 id="_12">实验三<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>将相关参数的配置更新</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.core.somaxconn<span class="o">=</span><span class="m">128</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_max_syn_backlog<span class="o">=</span><span class="m">512</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_syncookies<span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>理论上：</p>
<ul>
<li>当全连接队列未满，<code>syncookies = 1</code>，理论上 SYN 请求永远不会被 Drop</li>
</ul>
<p>启动服务端 Server 监听 8888 端口</p>
<p>客户端 Client 发起 SYN Flood 攻击：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>hping3<span class="w"> </span>-S<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span><span class="w"> </span>--flood
HPING<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span><span class="o">(</span>en1<span class="w"> </span><span class="m">192</span>.168.31.76<span class="o">)</span>:<span class="w"> </span>S<span class="w"> </span>set,<span class="w"> </span><span class="m">40</span><span class="w"> </span>headers<span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>data<span class="w"> </span>bytes
hping<span class="w"> </span><span class="k">in</span><span class="w"> </span>flood<span class="w"> </span>mode,<span class="w"> </span>no<span class="w"> </span>replies<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>shown
</code></pre></div>
<p>查看服务端 Server 8888端口处于 <code>SYN_RECV</code> 状态的 socket 最大个数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">128</span><span class="w"> </span>

$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">128</span><span class="w"> </span>
</code></pre></div>
<p>实验发现即使 <code>syncookies=1</code>，当半连接队列长度 &gt; 全连接队列最大长度时，就会触发 DROP SYN 请求。与理论不符合，需要继续研究。</p>
<h3 id="_13">实验四<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>将相关参数的配置更新</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.core.somaxconn<span class="o">=</span><span class="m">5</span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_max_syn_backlog<span class="o">=</span><span class="m">512</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_syncookies<span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>发起 SYN Flood 攻击后，查看服务端 Server 8888端口处于 <code>SYN_RECV</code> 状态的 socket 最大个数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">5</span><span class="w"> </span>

$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">6</span><span class="w"> </span>
</code></pre></div>
<p>确实 即使 <code>syncookies=1</code>，当半连接队列长度 &gt; 全连接最大长度时，就会触发 DROP SYN 请求。</p>
<h3 id="_14">实验五：<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>理论上：</p>
<ul>
<li>当半连接队列大小到 256 后，后触发 DROP SYN 请求</li>
</ul>
<p>将相关参数的配置更新</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.core.somaxconn<span class="o">=</span><span class="m">256</span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_max_syn_backlog<span class="o">=</span><span class="m">512</span><span class="w"> </span>
$<span class="w"> </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-w<span class="w"> </span>net.ipv4.tcp_syncookies<span class="o">=</span><span class="m">1</span>
</code></pre></div>
<p>启动服务端 Server 监听 8888 端口。</p>
<p>客户端 Client 发起 SYN Flood 攻击:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>hping3<span class="w"> </span>-S<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span><span class="w"> </span>--flood
HPING<span class="w"> </span><span class="m">192</span>.168.31.76<span class="w"> </span><span class="o">(</span>en1<span class="w"> </span><span class="m">192</span>.168.31.76<span class="o">)</span>:<span class="w"> </span>S<span class="w"> </span>set,<span class="w"> </span><span class="m">40</span><span class="w"> </span>headers<span class="w"> </span>+<span class="w"> </span><span class="m">0</span><span class="w"> </span>data<span class="w"> </span>bytes
hping<span class="w"> </span><span class="k">in</span><span class="w"> </span>flood<span class="w"> </span>mode,<span class="w"> </span>no<span class="w"> </span>replies<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>shown
</code></pre></div>
<p>查看服务端 Server 8888 端口处于 <code>SYN_RECV</code> 状态的 socket 最大个数：</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">256</span><span class="w"> </span>

$<span class="w"> </span>sudo<span class="w"> </span>netstat<span class="w"> </span>-nat<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>:8888<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SYN_RECV<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="w"> </span>
<span class="m">256</span><span class="w"> </span>
</code></pre></div>
<p>实验结果符合预期，当半连接队列长度增长至 256 后，后续 SYN 请求就会触发 Drop。</p>
<h2 id="_15">回顾线上问题<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>再回顾值班时遇到的 Connection timeout 问题，当时相关系统参数配置为：</p>
<ul>
<li>net.core.somaxconn = 128</li>
<li>net.ipv4.tcp_max_syn_backlog = 512</li>
<li>net.ipv4.tcp_syncookies = 1</li>
<li>net.ipv4.tcp_abort_on_overflow = 0</li>
</ul>
<p>所以出现 Connection timeout 有两种可能情况：</p>
<p>1、半连接队列未满，全连接队列满，Client 端向 Server 端发起 SYN 被 DROP (参考全连接队列实验结果情况三分析、半连接队列溢出实验情况三)</p>
<p>2、全连接队列未满，半连接队列大小超过全链接队列最大长度(参考半连接队列溢出实验情况三、半连接队列溢出实验情况四)</p>
<p>问题的最快修复方式是将 <code>net.core.somaxconn</code> 调大，以及 <code>net.ipv4.tcp_abort_on_overflow</code> 设置为 1，<code>net.ipv4.tcp_abort_on_overflow</code> 设置为 1 是为了让 client fail fast。</p>
<h2 id="_16">总结<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<p>半连接队列溢出、全连接队列溢出这类问题很容易被忽略，同时这类问题又很致命。当半连接队列、全连接队列溢出时 Server 端，从监控上来看系统 cpu 水位、内存水位、网络连接数等一切正常，然而却会持续影响 Client 端业务请求。对于高负载上游使用短连接的情况，出现这类问题的可能性更大。</p>
<p>本文详细梳理了 TCP 半连接队列、全连接队列的理论知识，同时结合 Linux 相关内核代码以及详细的动手实验，讲解了 TCP 半连接队列、全连接队列的相关原理、溢出判断、问题分析等内容，希望大家在阅读后可以对 TCP 半连接队列、全连接队列有更充分的认识。</p>
<p>PS：可以去线上检查下服务器的相关参数哟~</p>
<p>附录</p>
<p>这里罗列下相关参考博文资料：</p>
<p>Linux 源码</p>
<ul>
<li><a href="https://github.com/torvalds/linux">https://github.com/torvalds/linux</a></li>
</ul>
<p>Linux 诡异的半连接队列长度</p>
<ul>
<li><a href="https://www.cnblogs.com/zengkefu/p/5606696.html">https://www.cnblogs.com/zengkefu/p/5606696.html</a></li>
</ul>
<p>TCP 半连接队列和全连接队列满了会发生什么</p>
<ul>
<li><a href="https://www.cnblogs.com/xiaolincoding/p/12995358.html">https://www.cnblogs.com/xiaolincoding/p/12995358.html</a></li>
</ul>
<p>一次 HTTP connect-timeout 排查</p>
<ul>
<li><a href="https://www.jianshu.com/p/3b9c4216b822">https://www.jianshu.com/p/3b9c4216b822</a></li>
</ul>
<p>Connection Reset 排查</p>
<ul>
<li><a href="https://cjting.me/2019/08/28/tcp-queue/">https://cjting.me/2019/08/28/tcp-queue/</a></li>
</ul>
<p>深入浅出 TCP 中的 SYN-Cookies</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000019292140">https://segmentfault.com/a/1190000019292140</a></li>
</ul>
<p>《TCP/IP 详解 卷一：协议》第十八章
- <a href="https://flylib.com/books/en/3.223.1.193/1/">https://flylib.com/books/en/3.223.1.193/1/</a></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>由于开启了 <code>tcp_syncookies</code>, 当全连接队列未满时，永远不会 Drop 请求 (注意：经实验发现这个理论是错误的，实验发现只要半连接队列的大小 &gt; 全连接队列最大长度就会触发 Drop SYN 请求);
  当全连接队列满了后，即全连接队列大小到 1024 后，就会触发 Drop SYN 请求&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; wgzhao
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/01mlsx" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/wgzhao" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.indexes", "navigation.expand", "content.code.annotate", "content.tabs.link", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "header.autohide", "announce.dismiss", "toc.integrate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5090c770.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://cdn.jsdelivr.net/gh/rod2ik/cdn@main/mkdocs/javascripts/mkdocs-graphviz.js"></script>
      
    
  </body>
</html>